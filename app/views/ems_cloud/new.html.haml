- url = @ems.persisted? ? ems_clouds_path(@ems) : ems_clouds_path
= form_for(@ems,
           :url    => url,
           :method => :post,
           :html   => {"ng-controller"   => "emsCommonFormController",
                       "name"            => "angularForm",
                       "ng-show"         => "afterGet",
                       "create-url"      => "#{url}",
                       "form-fields-url" => "/#{controller_name}/ems_cloud_form_fields/",
                       "novalidate"      => true}) do |f|
  %input{:type => 'hidden', :id => "form_id", :value => "##{f.options[:html][:id]}"}
  %input{:type => 'hidden', :id => "button_name", :name => "button", :value => "add"}
  %input{:type => 'hidden', :id => "cred_type", :name => "cred_type", :value => "default"}
  = render :partial => "layouts/flash_msg"
  = render :partial => "shared/views/ems_common/angular/form"
  %ems-shared-form{'after-get'                      => 'afterGet',
                   'shared-form-model'              => "sharedFormModel",
                   'ems-type-options'               => "#{@ems_types}",
                   'new-record'                     => true,
                   'show-provider-region'           => "#{@provider_regions.keys.to_json}.includes(sharedFormModel.emsType)",
                   'provider-region-options'        => "providerRegionOptions[sharedFormModel.emsType]",
                   'show-ems-project'               => "sharedFormModel.emsType === 'gce'",
                   'show-ems-tenant-id'             => "sharedFormModel.emsType === 'azure'",
                   'show-subscription-id'           => "sharedFormModel.emsType === 'azure'",
                   'show-api-version'               => "sharedFormModel.emsType === 'openstack' || sharedFormModel.emsType === 'openstack_infra'",
                   'api-version-options'            => "#{@openstack_api_versions}",
                   'show-keystone-domain'           => "sharedFormModel.apiVersion === 'v3' && (sharedFormModel.emsType === 'openstack' || sharedFormModel.emsType === 'openstack_infra')",
                   'show-nuage-api-version'         => "sharedFormModel.emsType === 'nuage_network'",
                   'nuage-api-version-options'      => "#{@nuage_api_versions}",
                   'show-ems-infra-provider-id'     => "sharedFormModel.emsType === 'openstack' && emsCommonModel.openstack_infra_providers_exist",
                   'ems-infra-provider-id-options'  => @openstack_infra_providers.sort_by { |name, _name| name },
                   'ems-zone-options'               => @server_zones.sort_by { |name, _name| name },
                   'show-tenant-mapping'            => "sharedFormModel.emsType === 'openstack'",
                   'show-provider-region-input'     => "sharedFormModel.emsType === 'openstack' || sharedFormModel.emsType === 'openstack_infra'",
                   'show-vnc-start-port'            => "sharedFormModel.emsTypeVm"}

  %hr
  %div{"ng-if" => "sharedFormModel.emsType === 'azure'"}
    %h3
      = _("Credentials")
    %auth-credentials{'form-model'          => 'emsCommonModel',
                      'model-copy'          => 'modelCopy',
                      'prefix'              => "{{'default'}}",
                      'user-required'       => true,
                      'password-required'   => true,
                      'new-record'          => true,
                      'guid-regex'          => true,
                      'enable-valid-button' => 'angularForm.$valid',
                      'form-labels'         => 'crendetialsLabels',
                      'hide-user'           => false,
                      'hide-password'       => false,
                      'validate'            => 'sharedValidateClicked'}


:javascript
  ManageIQ.angular.app.value('emsCommonFormId', '#{@ems.id || "new"}');
  ManageIQ.angular.app.value('providerRegionOptions', #{@provider_regions.to_json})
  miq_bootstrap($('#form_id').val());
