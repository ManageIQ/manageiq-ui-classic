- click_url                   ||= false
- cookie_prefix               ||= ""
- check_url                   ||= false
- select_node                 ||= false
- checkboxes                  ||= false
- three_checks                ||= false
- onclick                     ||= false
- onselect                    ||= false
- oncheck                     ||= false
- autoload                    ||= false
- allow_reselect              ||= false
- highlight_changes           ||= false
- post_check                  ||= false
- bs_tree                     ||= '{}'
- tree_id                     ||= "tree_div"
- tree_name                   ||= "tree"

- options = {:tree_id            => tree_id,
             :tree_name          => tree_name,
             :group_changed      => session[:group_changed],
             :cookie_id          => "#{cookie_prefix}#{tree_name}",
             :checkboxes         => checkboxes,
             :hierarchical_check => three_checks,
             :onclick            => onclick,
             :oncheck            => oncheck,
             :click_url          => click_url,
             :check_url          => check_url,
             :onselect           => onselect,
             :post_check         => post_check,
             :autoload           => autoload,
             :allow_reselect     => allow_reselect,
             :controller         => j(request.parameters[:controller]),
             :silent_activate    => @explorer && tree_name == x_active_tree.to_s,
             :select_node        => select_node,
             :highlight_changes  => highlight_changes,
             :active_tree        => x_active_tree}

:javascript
  miqInitTree(#{options.to_json.html_safe}, #{bs_tree.html_safe})

- if session[:group_changed]
  - session[:group_changed] = false
